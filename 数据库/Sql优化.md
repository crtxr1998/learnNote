# DDLåˆ›å»ºè¡¨å’Œåˆ›å»ºçº¦æŸçš„Sqlè¯­æ³•(Oracleä¸Mysqlå¤§åŒå°å¼‚)

**åˆ›å»ºè¡¨çš„è¯­å¥**

```plsql
 ---1ã€åˆ›å»ºæ¨¡æ‹Ÿçš„æ•°æ®è¡¨ ---
  --1.1.åˆ›å»ºå­¦ç”Ÿè¡¨Student
  create table Student(
         StuId NUMBER NOT NULL,     --å­¦ç”ŸID
         StuName VARCHAR2(10) NOT NULL, --åç§°
         Gender VARCHAR2(10)NOT NULL,  -- æ€§åˆ«
         Age NUMBER(2) NOT NULL,    -- å¹´é¾„     
         JoinDate DATE NULL,       --å…¥å­¦æ—¶é—´
         ClassId NUMBER NOT NULL,   --ç­çº§ID
         Address VARCHAR2(50) NULL   --å®¶åº­ä½å€           
  ); 
  --1.2ã€åˆ›å»ºç­çº§è¡¨StuClass 
  create table StuClass(
       classId NUMBER not null,     -- ç­çº§ID
       ClassName varchar2(20) not null,  --ç­çº§åç§°
       Notes varchar2(50) null default'ç­çº§ä¿¡æ¯',  --å¤‡æ³¨ï¼Œé»˜è®¤ç­çº§ä¿¡æ¯
  ); 
```

**åˆ›å»ºçº¦æŸçš„è¯­å¥**

```plsql
  ----2ã€åˆ›å»ºæ•°æ®è¡¨çš„çº¦æŸ---
  --2.1ï¼‰åˆ›å»ºä¸»é”®çº¦æŸ--
  alter table Student add constraint PK_Student_StuId primary key(StuId);
  alter table StuClass add constraint PK_StuClass_ClassId primary key(ClassId);
  --2.2) åˆ›å»ºæ£€æŸ¥çº¦æŸ--
  alter table Student add constraint CK_Student_Gender check(gender='ç”·' or gender='å¥³');
  alter table Student add constraint CK_Student_Age check(Age>=0 and Age<=100);
  --2.3)åˆ›å»ºå”¯ä¸€çº¦æŸ--
  alter table Student add constraint UQ_Student_StuName unique(StuName);
  --2.4)åˆ›å»ºé»˜è®¤çº¦æŸ--
  --alter table Student add constraint DF_Student_Address default('åœ°å€ä¸è¯¦');
  alter table Student Modify Address varchar(50) default 'åœ°å€ä¸è¯¦';
  alter table Student Modify JoinDate Date default sysdate;
  --2.5)åˆ›å»ºå¤–é”®çº¦æŸ--
  alter table Student add constraint FK_Student_StuCLass_ClassId 
  foreign key(ClassId) references StuClass(ClassId);
```
**åˆ›å»ºç´¢å¼•æ“ä½œ**

```plsql
1ã€åˆ›å»ºç´¢å¼•

create index <INDEXNAME> on <TABLENAME>(<COLUMN1>);

2ã€åˆ é™¤ç´¢å¼•

drop index <INDEXNAME>;

3ã€åˆ›å»ºç»„åˆç´¢å¼•

create index <INDEXNAME> on <TABLENAME> (<COLUMN1>,<COLUMN2>);

4ã€å®šæœŸçš„é‡æ„ç´¢å¼•: 

ALTER INDEX <INDEXNAME> REBUILD <TABLESPACENAME> 

5ã€æŸ¥çœ‹ç›®æ ‡è¡¨ä¸­å·²æ·»åŠ çš„ç´¢å¼•

    --åœ¨æ•°æ®åº“ä¸­æŸ¥æ‰¾è¡¨å
    SELECT * from user_tables where  table_name like 'tablename%';

    --æŸ¥çœ‹è¯¥è¡¨çš„æ‰€æœ‰ç´¢å¼•
    SELECT * from all_indexes where table_name = 'tablename';

    --æŸ¥çœ‹è¯¥è¡¨çš„æ‰€æœ‰ç´¢å¼•åˆ—
    SELECT * from all_ind_columns where table_name = 'tablename';

6ã€æŸ¥è¯¢æ—¶å¼ºåˆ¶æŒ‡å®šç´¢å¼•(ä¸€å®šè¦ä½¿ç”¨åˆ«åï¼Œä¸ç„¶ä¸ç”Ÿæ•ˆ)
SELECT /*+INDEX(mmp <INDEXNAME>)*/* FROM TB_BIZ_JZGJBXX mmp
```
## æ•°æ®åº“åŸºæœ¬æŸ¥è¯¢è¯­å¥ä½œç”¨

| **SELECT* FROM V$VERSION;**                                  | **æŸ¥çœ‹æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯** |
| ------------------------------------------------------------ | ---------------------- |
| **SELECT PLAN_TABLE_OUTPUT FROM TABLE(DBMS_XPLAN.DISPLAY());** | **æ˜¾ç¤ºæ‰§è¡Œè®¡åˆ’**       |
| **EXPLAIN PLAN FOR  Â·Â·Â·Â·Â·Â·**                                 | **éœ€è¦æ‰§è¡Œè®¡åˆ’çš„è¯­å¥** |
|                                                              |                        |

æ³¨æ„ï¼šåˆ›å»ºè¡¨è¿˜æ˜¯çº¦æŸï¼Œä¸SQL ServeråŸºæœ¬ç›¸åŒï¼Œæ³¨æ„ï¼šåœ¨Oracleä¸­defaultæ˜¯ä¸€ä¸ªå€¼ï¼Œè€ŒSQL Serverä¸­defaultæ˜¯ä¸€ä¸ªçº¦æŸï¼Œ

å› æ­¤Oracleçš„defaultè®¾ç½®å¯ä»¥åœ¨å»ºè¡¨çš„æ—¶å€™åˆ›å»ºæˆ–è€…é€šè¿‡Modifyå‡½æ•°åˆ›å»º

3ã€æ·»åŠ æ¨¡æ‹Ÿçš„æ•°æ®

```plsql
  --3ã€æ·»åŠ æ¨¡æ‹Ÿçš„æ•°æ®--
  --3.1ï¼‰æ·»åŠ ç­çº§ä¿¡æ¯
  insert into StuClass(ClassId,Classname) values(1,'ä¸€ç­');
  insert into StuClass(ClassId,Classname) values(2,'äºŒç­');
  insert into StuClass(ClassId,Classname) values(3,'ä¸‰ç­');
   --3.2ï¼‰æ·»åŠ å­¦ç”Ÿä¿¡æ¯
  insert into Student(StuId,Stuname,Gender,Age,ClassId)
  values(1,'å…³ç¾½','ç”·',17,1);
  insert into Student(StuId,Stuname,Gender,Age,ClassId)
  values(2,'å¼ é£','ç”·',16,2);
   insert into Student(StuId,Stuname,Gender,Age,ClassId)
  values(3,'åˆ˜å¤‡','ç”·',18,3);
```

# Oracleçš„Sqlä¼˜åŒ–ç¬”è®°

## ä½¿ç”¨å·¥å…·

- **Navicat      <b style='color:red'>æ²¡æœ‰Treeç»“æ„çœ‹æ­»äºº</b>**
- **PLSQL         <b style='color:red'>å»ºè®®</b>**

## Oracleä¼˜åŒ–è½¯ä»¶

- **Tosska SQL Tuning Expert**      <b style='color:red'>è‡ªåŠ¨åŒ–ä¼˜åŒ–å·¥å…· </b>           

## 

[å…³äºOracleçš„sqlä¼˜åŒ–,Navicatçš„ä½¿ç”¨](https://mp.weixin.qq.com/s/YI40HEZck49nnHXouSKZOw)

Oracleå¸¸ç”¨ä¼˜åŒ–ä¸€](https://mp.weixin.qq.com/s/OoBSxFI1dCI7RTgMu2jcbQ)

[Oracleå¸¸ç”¨ä¼˜åŒ–äºŒ](https://mp.weixin.qq.com/s/1ZsqKuqbgf9p0WaawS_vTA)

[Oracleå¸¸ç”¨ä¼˜åŒ–ä¸‰](https://mp.weixin.qq.com/s/4JmLTlcocGxR82n9YIo2JQ)

[Oracleå¸¸ç”¨ä¼˜åŒ–å››](https://mp.weixin.qq.com/s/dX2oKY2hAuFL2kELRyJ9XA)

[Oracleå¸¸ç”¨ä¼˜åŒ–äº”](https://mp.weixin.qq.com/s/sfZAis-B67Ff7aWJis8kMA)

[Oracleå¸¸ç”¨ä¼˜åŒ–å…­](https://mp.weixin.qq.com/s/8EolcaU2MljalnleV78wBg)



## **æ‰§è¡Œè®¡åˆ’ **

### ç›¸å…³çš„æ¦‚å¿µ

- **Rowidçš„æ¦‚å¿µ**
  rowidæ˜¯ä¸€ä¸ªä¼ªåˆ—ï¼Œè¿™ä¸ªåˆ—ä¸æ˜¯ç”¨æˆ·å®šä¹‰è€Œæ˜¯ç³»ç»Ÿè‡ªå·±ç»™åŠ ä¸Šçš„ã€‚æ¯ä¸ªè¡¨éƒ½æœ‰ä¸€ä¸ªrowidçš„ä¼ªåˆ—ï¼Œè¡¨ä¸­å¹¶ä¸ç‰©ç†å­˜å‚¨ROWIDçš„å€¼ï¼Œä½†å¯ä»¥åƒä½¿ç”¨å…¶ä»–åˆ—é‚£æ ·ä½¿ç”¨å®ƒï¼Œåªæ˜¯ä¸èƒ½åˆ é™¤ä¿®æ”¹è¯¥åˆ—ã€‚ä¸€æ—¦ä¸€è¡Œæ•°æ®æºå…¥æ•°æ®åº“ï¼Œåˆ™rowidåœ¨è¯¥è¡Œçš„ç”Ÿå‘½å‘¨æœŸå†…æ˜¯å”¯ä¸€çš„ï¼Œå³ä½¿è¯¥è¡Œäº§ç”Ÿè¡Œè¿ç§»ï¼Œè¡Œçš„rowidä¹Ÿä¸ä¼šæ”¹å˜ã€‚
- **Recursive SQLæ¦‚å¿µ**
  ä¸ºäº†æ‰§è¡Œç”¨æˆ·å‘å‡ºçš„ä¸€ä¸ªsqlè¯­å¥ï¼ŒOracleå¿…é¡»æ‰§è¡Œä¸€äº›é¢å¤–çš„è¯­å¥ï¼Œæˆ‘ä»¬å°†è¿™äº›é¢å¤–çš„è¯­å¥ç§°ä¹‹ä¸º'recursive calls'
- **Row Sourceè¡Œæº**
  ç”¨åœ¨æŸ¥è¯¢ä¸­ï¼Œç”±ä¸Šä¸€æ“ä½œè¿”å›çš„ç¬¦åˆæ¡ä»¶çš„è¡Œçš„é›†åˆï¼Œæ—¢å¯ä»¥æ˜¯è¡¨ä¸­å…¨éƒ¨çš„è¡Œæ•°æ®çš„é›†åˆï¼Œä¹Ÿå¯ä»¥æ˜¯è¡¨çš„éƒ¨åˆ†è¡Œæ•°æ®çš„é›†åˆï¼›
- **Predicateè°“è¯**
  ä¸€ä¸ªæŸ¥è¯¢ä¸­WHEREé™åˆ¶æ¡ä»¶
- **Driving Tableé©±åŠ¨è¡¨**
  é©±åŠ¨è¡¨åˆç§°å¤–å±‚è¡¨(OUTER TABLE)ã€‚è¿™ä¸ªæ¦‚å¿µç”¨äºåµŒå¥—è¿æ¥å’ŒHASHè¿æ¥ä¸­ï¼Œå¦‚æœè¯¥row sourceè¿”å›è¾ƒå¤šçš„è¡Œæ•°æ®ï¼Œåˆ™å¯¹åç»­æ“ä½œæœ‰è´Ÿé¢å½±å“ã€‚ä¸€èˆ¬è¯´æ¥ï¼Œåº”ç”¨æŸ¥è¯¢æ¡ä»¶çš„é™åˆ¶åï¼Œè¿”å›è¾ƒå°‘è¡Œæºçš„è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œæ‰€ä»¥ä¸€ä¸ªè¾¾æ ‡åœ¨whereæ¡ä»¶åè¿”å›è¾ƒå°‘æ•°æ®ï¼Œåˆ™å¤§è¡¨ä¹Ÿåˆé€‚ä½œä¸ºé©±åŠ¨è¡¨ï¼Œå¹¶ä¸æ˜¯åªæœ‰è¾ƒå°çš„è¡¨å¯ä»¥ä½œä¸ºé©±åŠ¨è¡¨ã€‚
- **Probed Table**
  è¯¥è¡¨é€šå¸¸è¢«ç§°ä½œå†…å±‚è¡¨(INNER TABLE)ã€‚ä»é©±åŠ¨è¡¨è·å–çš„å…·ä½“ä¸€è¡Œçš„æ•°æ®ï¼Œéœ€è¦åœ¨è¯¥è¡¨ä¸­å¯»æ‰¾ç¬¦åˆè¿æ¥æ¡ä»¶çš„è¡Œã€‚æ‰€ä»¥æ•°æ®é‡è¾ƒå¤§ï¼Œä¸”åœ¨ç›¸åº”è¿æ¥åˆ—ä¸Šæœ‰ç´¢å¼•çš„è¡¨é€‚åˆåšä¸ºå†…å±‚è¡¨ã€‚
- **ç»„åˆç´¢å¼•**
  é¡¾åæ€ä¹‰ï¼Œç»„åˆç´¢å¼•å°±æ˜¯ç”±å¤šä¸ªåˆ—ç»„æˆçš„ç´¢å¼•ã€‚ç»„åˆç´¢å¼•ä¸­çš„ç¬¬ä¸€ä¸ªåˆ—è¢«ç§°ä½œå¼•å¯¼åˆ—(LEADING COLUMN)ï¼Œåªæœ‰é™åˆ¶æ¡ä»¶ä¸­åŒ…å«å¼•å¯¼åˆ—æ—¶ï¼Œè¯¥é™åˆ¶æ¡ä»¶æ‰ä¼šä½¿ç”¨è¯¥ç»„åˆç´¢å¼•

### Oracleè®¿é—®æ•°æ®çš„æ–¹æ³•

1. **å…¨è¡¨æ‰«æ(FULL TABLE SCANS,FTS)**
   ä¸ºå®ç°å…¨è¡¨æ‰«æï¼ŒOracleè¯»å–è¡¨ä¸­æ‰€æœ‰çš„è¡Œï¼Œå¹¶æ£€æŸ¥æ¯ä¸€è¡Œæ˜¯å¦æ»¡è¶³è¯­å¥çš„whereæ¡ä»¶ã€‚ä¸€ä¸ªå¤šå—è¯»æ“ä½œå¯ä»¥ä½¿ä¸€æ¬¡I/Oèƒ½è¯»å–å¤šå—æ•°æ®(db_block_multiblock_read_countå‚æ•°è®¾å®š)ï¼Œè€Œä¸æ˜¯åªè¯»å–ä¸€ä¸ªæ•°æ®å—ï¼Œè¿™æå¤§çš„å‡å°‘äº†I/Oçš„æ€»æ¬¡æ•°ï¼Œæé«˜äº†ç³»ç»Ÿçš„ååé‡ï¼Œæ‰€ä»¥åˆ©ç”¨å¤šå—è¯»çš„æ–¹æ³•å¯ä»¥ååˆ†é«˜æ•ˆçš„å®ç°å…¨è¡¨æ‰«æï¼Œè€Œä¸”åªæœ‰åœ¨å…¨è¡¨æ‰«æçš„æƒ…å†µä¸‹æ‰èƒ½ä½¿ç”¨å¤šå—è¯»æ“ä½œã€‚ä½¿ç”¨FTSçš„å‰ææ¡ä»¶ï¼šåœ¨è¾ƒå¤§çš„è¡¨ä¸Šä¸å»ºè®®ä½¿ç”¨å…¨è¡¨æ‰«æï¼Œé™¤éå–å‡ºçš„æ•°æ®æ¯”è¾ƒå¤šï¼Œè¶…è¿‡æ€»é‡çš„5%-10%ï¼Œæˆ–è€…æƒ³ä½¿ç”¨å¹¶è¡ŒæŸ¥è¯¢åŠŸèƒ½ã€‚
2. **é€šè¿‡ROWID(TABLE ACCESS BY ROWID)**
   è¡Œçš„ROWIDæŒ‡å‡ºäº†è¯¥è¡Œæ‰€åœ¨çš„æ•°æ®æ–‡ä»¶ï¼Œæ•°æ®å—åŠè¯¥è¡Œåœ¨è¯¥å—ä¸­çš„ä½ç½®ï¼Œæ‰€ä»¥é€šè¿‡ROWIDæ¥å­˜å–æ•°æ®å¯ä»¥å¿«é€Ÿå®šä½åˆ°ç›®æ ‡æ•°æ®ä¸Šï¼Œæ˜¯Oracleå­˜å–å•è¡Œæ•°æ®çš„æœ€å¿«æ–¹æ³•ã€‚
3. **ç´¢å¼•æ‰«æ(INDEX SCAN/INDEX LOOKUP)**
   é€šè¿‡Indexå…ˆæŸ¥æ‰¾åˆ°æ•°æ®å¯¹åº”çš„rowidå€¼ï¼Œç„¶åæ ¹æ®rowidç›´æ¥ä»è¡¨ä¸­å¾—åˆ°å…·ä½“çš„æ•°æ®ï¼Œè¿™ç§æŸ¥æ‰¾æ–¹å¼ç§°ä¸ºç´¢å¼•æ‰«æã€‚åœ¨ç´¢å¼•ä¸­ï¼Œé™¤äº†å­˜å‚¨æ¯ä¸ªç´¢å¼•çš„å€¼å¤–ï¼Œç´¢å¼•è¿˜å­˜å‚¨å…·ä½“æ­¤å€¼çš„è¡Œå¯¹åº”çš„ROWIDå€¼ã€‚
   ç´¢å¼•æ‰«æç”±ä¸¤æ­¥ç»„æˆï¼š

```flow
st=>start: æ‰«æç´¢å¼•å¾—åˆ°rowid
e=>end: é€šè¿‡rowidè¯»å‡ºæ•°æ®

st->e
```

æ¯æ­¥éƒ½æ˜¯ä¸€æ¬¡å•ç‹¬çš„I/Oï¼Œä½†æ˜¯å¯¹äºç´¢å¼•ï¼Œç”±äºç»å¸¸ä½¿ç”¨ï¼Œç»å¤§å¤šæ•°éƒ½å·²ç»CACHEåˆ°å†…å­˜ä¸­ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥çš„I/Oç»å¸¸æ˜¯é€»è¾‘I/Oï¼Œå³æ•°æ®å¯ä»¥ä»å†…å­˜ä¸­å¾—åˆ°ã€‚ä½†å¯¹äºç¬¬äºŒéƒ¨æ¥è¯´ï¼Œå¦‚æœè¡¨æ¯”è¾ƒå¤§ï¼Œåˆ™å…¶æ•°æ®ä¸å¯èƒ½å…¨åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥å…¶I/Oå¾ˆæœ‰å¯èƒ½æ˜¯ç‰©ç†I/Oï¼Œè¿™æ˜¯ä¸€ä¸ªæœºæ¢°æ“ä½œï¼Œç›¸å¯¹é€»è¾‘I/Oæ¥è¯´ï¼Œæå…¶è´¹æ—¶é—´ã€‚æ‰€ä»¥å¦‚æœå¯¹å¤§è¡¨è¿›è¡Œç´¢å¼•æ‰«æï¼Œå–å‡ºçš„æ•°æ®å¦‚æœå¤§äºæ€»é‡çš„5%-10%ï¼Œä½¿ç”¨ç´¢å¼•æ‰«ææ•ˆç‡ä¼šä¸‹é™å¾ˆå¤šã€‚ä½†æ˜¯å¦‚æœæŸ¥è¯¢çš„æ•°æ®èƒ½å…¨åœ¨ç´¢å¼•ä¸­æ‰¾åˆ°ï¼Œå°±å¯ä»¥é¿å…è¿›è¡Œç¬¬äºŒæ­¥æ“ä½œï¼Œé¿å…äº†ä¸å¿…è¦çš„I/Oï¼Œæ­¤æ—¶å³ä½¿é€šè¿‡ç´¢å¼•æ‰«æå–å‡ºçš„æ•°æ®æ¯”è¾ƒå¤šï¼Œæ•ˆç‡è¿˜æ˜¯å¾ˆé«˜çš„ã€‚å†è€…ï¼Œå¦‚æœsqlè¯­å¥ä¸­éœ€è¦å¯¹ç´¢å¼•åˆ—è¿›è¡Œæ’åºï¼Œå› ä¸ºç´¢å¼•å·²ç»é¢„å…ˆæ’åºå¥½äº†ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œè®¡åˆ’ç´¢å¼•è¿›è¡Œæ’åºã€‚
 æ ¹æ®ç´¢å¼•çš„ç±»å‹å’Œwhereé™åˆ¶æ¡ä»¶çš„ä¸åŒï¼Œä¸€èˆ¬æœ‰å¦‚ä¸‹4ä¸­ç±»å‹çš„ç´¢å¼•æ‰«æï¼š

- **ç´¢å¼•å”¯ä¸€æ‰«æ(index unique scan)**
  é€šè¿‡å”¯ä¸€ç´¢å¼•æŸ¥æ‰¾ä¸€ä¸ªæ•°å€¼ç»å¸¸è¿”å›å•ä¸ªROWIDï¼Œå¦‚æœå­˜åœ¨UNIQUEæˆ–PRIMARY KEYçº¦æŸ(å®ƒä¿è¯äº†è¯­å¥åªå­˜å–å•è¡Œ)çš„è¯ï¼ŒOracleç»å¸¸å®ç°å”¯ä¸€æ€§æ‰«æã€‚
- **ç´¢å¼•èŒƒå›´æ‰«æ(index range scan)**
  ä½¿ç”¨ä¸€ä¸ªç´¢å¼•å­˜å–å¤šè¡Œæ•°æ®ã€‚ä»¥ä¸‹ä¸‰ç§æƒ…å†µä¼šä½¿ç”¨index range scanï¼š
  1. åœ¨å”¯ä¸€ç´¢å¼•åˆ—ä¸Šä½¿ç”¨äº†rangeæ“ä½œç¬¦(> < <> >= <= between and)
  2. åœ¨ç»„åˆç´¢å¼•ä¸Šï¼Œåªä½¿ç”¨éƒ¨åˆ†åˆ—è¿›è¡ŒæŸ¥è¯¢ï¼Œå¯¼è‡´æŸ¥è¯¢å‡ºå¤šè¡Œ
  3. åœ¨éå”¯ä¸€ç´¢å¼•åˆ—ä¸Šè¿›è¡ŒæŸ¥è¯¢
- **ç´¢å¼•å…¨æ‰«æ(index full scan)**
  ä¸å…¨è¡¨æ‰«æç›¸å¯¹åº”ï¼Œä¹Ÿæœ‰ç›¸åº”çš„å…¨ç´¢å¼•æ‰«æè€Œä¸”æ­¤æ—¶æŸ¥è¯¢å‡ºçš„æ•°æ®éƒ½å¿…é¡»ä»ç´¢å¼•ä¸­å¯ä»¥ç›´æ¥å¾—åˆ°ã€‚
- **ç´¢å¼•å¿«é€Ÿæ‰«æ(index fast full scan)**
  æ‰«æç´¢å¼•ä¸­çš„ç´¢å¼•æ•°æ®å—ï¼Œä¸index full scanå¾ˆç±»ä¼¼ï¼Œä½†æ˜¯ä¸€ä¸ªæ˜¾è‘—çš„åŒºåˆ«å°±æ˜¯å®ƒä¸å¯¹æŸ¥è¯¢å‡ºçš„æ•°æ®æ’åºï¼Œå³æ•°æ®ä¸æ˜¯ä»¥æ’åºé¡ºåºè¢«è¿”å›ã€‚

### è¡¨ä¹‹é—´çš„è¿æ¥æ–¹å¼

Joinæ˜¯ä¸€ç§è¯•å›¾å°†ä¸¤ä¸ªè¡¨ç»“åˆåœ¨ä¸€èµ·çš„è°“è¯ï¼Œä¸€æ¬¡åªèƒ½è¿æ¥ä¸¤ä¸ªè¡¨ã€‚Joinå¯ä»¥å¹¶è¡Œçš„è¯»å–ä¸¤ä¸ªè¿æ¥çš„è¡¨çš„æ•°æ®ï¼Œä½†å°†è¡¨ä¸­ç¬¦åˆé™åˆ¶æ¡ä»¶çš„æ•°æ®æ®µè¯»å…¥å†…å­˜å½¢æˆrow sourceåï¼Œjoinçš„å…¶å®ƒæ­¥éª¤ä¸€èˆ¬éƒ½æ˜¯ä¸²è¡Œçš„ã€‚
 ç›®å‰ä¸ºæ­¢ï¼Œå…¸å‹çš„joinè¿æ¥ç±»å‹æœ‰3ä¸­ï¼š

- **æ’åºåˆå¹¶è¿æ¥(Sort Merge Join(SMJ))**
  å†…éƒ¨è¿æ¥è¿‡ç¨‹ï¼š
  1. é¦–å…ˆç”Ÿæˆrow source1éœ€è¦çš„æ•°æ®ï¼Œç„¶åå¯¹è¿™äº›æ•°æ®æŒ‰ç…§è¿æ¥æ“ä½œç›¸å…³åˆ—è¿›è¡Œæ’åºã€‚
  2. éšåç”Ÿæˆrow source2éœ€è¦çš„æ•°æ®ï¼Œç„¶åå¯¹è¿™äº›æ•°æ®æŒ‰ç…§ä¸sort source1å¯¹åº”çš„è¿æ¥æ“ä½œå…³è”åˆ—æ’åºã€‚
  3. æœ€åä¸¤è¾¹å·²æ’åºçš„è¡Œè¢«æ”¾åœ¨ä¸€èµ·æ‰§è¡Œåˆå¹¶æ“ä½œï¼Œå³å°†ä¸¤ä¸ªrow sourceæŒ‰ç…§è¿æ¥æ¡ä»¶è¿æ¥èµ·æ¥ã€‚

å¦‚æœrow sourceå·²ç»åœ¨å…³è”åˆ—ä¸Šè¢«æ’åºï¼Œåˆ™è¯¥è¿ç»“æ“ä½œå°±ä¸éœ€è¦å†è¿›è¡Œsortæ“ä½œï¼Œè¿™æ ·å¯ä»¥å¤§å¤§æé«˜è¿™ç§è¿æ¥æ“ä½œçš„è¿æ¥é€Ÿåº¦ï¼Œå› ä¸ºæ’åºæ˜¯ä¸ªæå…¶è€—è´¹èµ„æºçš„æ“ä½œã€‚é¢„å…ˆæ’åºçš„row sourceåŒ…æ‹¬å·²ç»è¢«ç´¢å¼•çš„åˆ—æˆ–row sourceå·²ç»åœ¨å‰é¢çš„æ­¥éª¤ä¸­è¢«æ’åºäº†ã€‚å¦å¤–ï¼Œå°½ç®¡åˆå¹¶ä¸¤ä¸ªrow sourceçš„è¿‡ç¨‹æ˜¯ä¸²è¡Œçš„ï¼Œä½†æ˜¯å¯ä»¥å¹¶è¡Œè®¿é—®è¿™ä¸¤ä¸ªrow sourceï¼ˆå¦‚å¹¶è¡Œè¯»å…¥æ•°æ®ï¼Œæ’åºï¼‰ã€‚
 æ’åºæ˜¯ä¸€ä¸ªè´¹æ—¶ï¼Œè´¹èµ„æºçš„æ“ä½œï¼ŒåŸºäºè¿™ä¸ªåŸå› ï¼ŒSMJé€šå¸¸ä¸æ˜¯ä¸€ç§æœ‰æ•ˆç‡çš„è¿æ¥æ–¹å¼ï¼Œä½†å½“row sourceå·²ç»æ’å¥½åºçš„å‰æä¸‹ï¼ŒSMJçš„æ•ˆç‡è¿˜æ˜¯å¾ˆå¯è§‚çš„ã€‚

1. **åµŒå¥—å¾ªç¯è¿æ¥(Nested Loops(NL))**
    è¿™ä¸ªè¿æ¥æ–¹æ³•æœ‰é©±åŠ¨è¡¨ï¼ˆå¤–éƒ¨è¡¨ï¼‰çš„æ¦‚å¿µã€‚è¯¥è¿æ¥è¿‡ç¨‹å°±æ˜¯ä¸€ä¸ª2å±‚åµŒå¥—å¾ªç¯ï¼Œæ‰€ä»¥å¤–å±‚å¾ªç¯çš„æ¬¡æ•°è¶Šå°‘è¶Šå¥½ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å°†å°è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼ˆç”¨äºå¤–å±‚å¾ªç¯ï¼‰çš„ç†è®ºä¾æ®ã€‚ä½†æ˜¯è¿™ä¸ªç†è®ºåªæ˜¯ä¸€èˆ¬æŒ‡å¯¼åŸåˆ™ï¼Œå› ä¸ºéµå¾ªè¿™ä¸ªç†è®ºå¹¶ä¸èƒ½æ€»ä¿è¯ä½¿è¯­å¥äº§ç”Ÿçš„I/0æ¬¡æ•°æœ€å°‘ã€‚
    åœ¨NESTED LOOPSè¿æ¥ä¸­ï¼ŒOracleè¯»å–å¤–éƒ¨è¡¨çš„æ¯ä¸€è¡Œï¼Œç„¶åå†å†…éƒ¨è¡¨ä¸­æ£€æŸ¥æ˜¯å¦æœ‰åŒ¹é…çš„è¡Œï¼Œæ‰€æœ‰è¢«åŒ¹é…çš„è¡Œéƒ½è¢«æ”¾åˆ°ç»“æœé›†ä¸­ï¼Œç„¶åå¤„ç†å¤–éƒ¨è¡¨çš„ä¸‹ä¸€è¡Œã€‚å¦‚æœå¤–éƒ¨è¡¨æ¯”è¾ƒå°ï¼Œå¹¶ä¸”åœ¨å†…éƒ¨è¡¨ä¸­æœ‰å”¯ä¸€é«˜é€‰æ‹©æ€§éå”¯ä¸€ç´¢å¼•æ—¶ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•å¯ä»¥å¾—åˆ°è¾ƒå¥½çš„æ•ˆç‡ã€‚NESTED LOOPSæœ‰å…¶å®ƒè¿æ¥æ–¹æ³•æ²¡æœ‰çš„ä¸€ä¸ªä¼˜ç‚¹ï¼šå¯ä»¥å…ˆè¿”å›å·²ç»è¿æ¥çš„è¡Œï¼Œè€Œä¸å¿…ç­‰å¾…æ‰€æœ‰çš„è¿æ¥æ“ä½œå¤„ç†å®Œæˆæ‰è¿”å›æ•°æ®ï¼Œè¿™å¯ä»¥å®ç°å¿«é€Ÿçš„å“åº”æ—¶é—´ã€‚
    å¦‚æœä¸é€‚ç”¨å¹¶è¡Œæ“ä½œï¼Œæœ€å¥½çš„é©±åŠ¨è¡¨æ˜¯é‚£äº›åº”ç”¨äº†whereæ¡ä»¶é™åˆ¶åï¼Œå¯ä»¥è¿”å›è¾ƒå°‘è¡Œæ•°æ®çš„è¡¨ã€‚å¯¹äºå¹¶è¡ŒæŸ¥è¯¢ï¼Œæˆ‘ä»¬ç»å¸¸é€‰æ‹©å¤§è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œå› ä¸ºå¤§è¡¨å¯ä»¥å……åˆ†åˆ©ç”¨å¹¶è¡ŒåŠŸèƒ½ã€‚å½“ç„¶ï¼Œæœ‰æ—¶å¯¹æŸ¥è¯¢ä½¿ç”¨å¹¶è¡Œæ“ä½œä¸ä¸€å®šæ¯”æŸ¥è¯¢ä¸ä½¿ç”¨å¹¶è¡Œæ“ä½œæ•ˆç‡é«˜ï¼Œå› ä¸ºæœ€åå¯èƒ½æ¯ä¸ªè¡¨åªæœ‰å¾ˆå°‘çš„è¡Œç¬¦åˆé™åˆ¶æ¡ä»¶ï¼Œè€Œä¸”è¿˜è¦çœ‹ä½ çš„ç¡¬ä»¶é…ç½®æ˜¯å¦æ”¯æŒå¹¶è¡Œï¼ˆå¤šä¸ªCPUï¼Œå¤šä¸ªç¡¬ç›˜æ§åˆ¶å™¨ï¼‰ã€‚

2. **å“ˆå¸Œè¿æ¥(Hash Join)**
    å“ˆå¸Œè¿æ¥æ˜¯åœ¨Oracle7.3ä»¥åå¼•å…¥çš„ï¼Œä»ç†è®ºä¸Šæ¥è¯´æ¯”NLå’ŒSMJæ›´é«˜æ•ˆï¼Œè€Œä¸”åªç”¨åœ¨CBOä¼˜åŒ–å™¨ä¸­ã€‚
    è¾ƒå°çš„row sourceè¢«ç”¨æ¥æ„å»ºhash tableä¸bitmapï¼Œç¬¬äºŒä¸ªrow sourceç”¨æ¥äºç¬¬ä¸€ä¸ªrow sourceç”Ÿæˆçš„hash tableè¿›è¡ŒåŒ¹é…ï¼Œä»¥ä¾¿è¿›è¡Œè¿›ä¸€æ­¥çš„è¿æ¥ã€‚Bitmapè¢«ç”¨æ¥ä½œä¸ºä¸€ç§æ¯”è¾ƒå¿«çš„æŸ¥æ‰¾æ–¹æ³•ï¼Œæ¥æ£€æŸ¥å†hash tableä¸­æ˜¯å¦æœ‰åŒ¹é…çš„è¡Œã€‚ç‰¹åˆ«çš„ï¼Œå½“hash tableæ¯”è¾ƒå¤§è€Œä¸èƒ½å…¨éƒ¨å®¹çº³åœ¨å†…å­˜ä¸­æ—¶ï¼Œè¿™ç§æŸ¥æ‰¾æ–¹æ³•æ›´ä¸ºæœ‰ç”¨ã€‚è¿™ç§è¿æ¥æ–¹æ³•ä¹Ÿæœ‰é©±åŠ¨è¡¨çš„æ¦‚å¿µï¼Œè¢«æ„å»ºä¸ºhash tableä¸bitmapçš„è¡¨ä¸ºé©±åŠ¨è¡¨ï¼Œå½“è¢«æ„å»ºçš„hash tableä¸bitmapèƒ½è¢«å®¹çº³åœ¨å†…å­˜ä¸­ï¼Œè¿™ç§è¿æ¥æ–¹å¼çš„æ•ˆç‡æé«˜ã€‚
    è¦æ˜¯å“ˆå¸Œè¿æ¥æœ‰æ•ˆï¼Œéœ€è¦è®¾ç½®HASH_JOIN_ENABLED=TRUE,ç¼ºçœæƒ…å†µä¸‹è¯¥å‚æ•°ä¸ºTRUE,å¦å¤–è¿˜éœ€è¦è®¾ç½®hash_area_sizeå‚æ•°ï¼Œä»¥ä½¿å“ˆå¸Œè¿æ¥é«˜æ•ˆè¿è¡Œï¼Œå› ä¸ºå“ˆå¸Œè¿æ¥ä¼šåœ¨å‚æ•°æŒ‡å®šçš„å¤§å°çš„å†…å­˜ä¸­è¿è¡Œï¼Œè¿‡å°çš„å‚æ•°ä¼šä½¿å“ˆå¸Œè¿æ¥çš„æ€§èƒ½æ¯”å…¶ä»–è¿æ¥æ–¹å¼ä½ã€‚

3. **è¡¨è®¿é—®çš„æ‰§è¡Œè®¡åˆ’**

  1ã€table access fullï¼šå…¨è¡¨æ‰«æã€‚å®ƒä¼šè®¿é—®è¡¨ä¸­çš„æ¯ä¸€æ¡è®°å½•ã€‚

  2ã€table access by user rowidï¼šè¾“å…¥æºrowidæ¥è‡ªäºç”¨æˆ·æŒ‡å®šã€‚

  3ã€table access by index rowidï¼šè¾“å…¥æºrowidæ¥è‡ªäºç´¢å¼•ã€‚

  4ã€table access by global index rowidï¼šå…¨å±€ç´¢å¼•è·å–rowidï¼Œç„¶åå†å›è¡¨ã€‚

  5ã€table access by local index rowidï¼šåˆ†åŒºç´¢å¼•è·å–rowidï¼Œç„¶åå†å›è¡¨ã€‚

  6ã€table access clusterï¼šé€šè¿‡ç´¢å¼•ç°‡çš„é”®æ¥è®¿é—®ç´¢è¡¨ã€‚

  7ã€external table accessï¼šè®¿é—®å¤–éƒ¨è¡¨ã€‚

  8ã€result cacheï¼šç»“æœé›†å¯èƒ½æ¥è‡ªäºç¼“å­˜ã€‚

  9ã€mat_view rewrite accessï¼šç‰©åŒ–è§†å›¾ã€‚

  ç´¢å¼•è®¿é—®çš„æ‰§è¡Œè®¡åˆ’

  1ã€index unique scanï¼šåªè¿”å›ä¸€æ¡rowidçš„ç´¢å¼•æ‰«æï¼Œæˆ–è€…uniqueç´¢å¼•çš„ç­‰å€¼æ‰«æã€‚

  2ã€index range scanï¼šè¿”å›å¤šæ¡rowidçš„ç´¢å¼•æ‰«æã€‚

  3ã€index full scanï¼šé¡ºåºæ‰«ææ•´ä¸ªç´¢å¼•ã€‚

  4ã€index fast full scanï¼šå¤šå—è¯»æ–¹å¼æ‰«ææ•´ä¸ªç´¢å¼•ã€‚

  5ã€index skip scanï¼šå¤šåº”ç”¨äºç»„åˆç´¢å¼•ä¸­ï¼Œå¼•å¯¼é”®å€¼ä¸ºç©ºçš„æƒ…å†µä¸‹ç´¢å¼•æ‰«æã€‚

  6ã€and-equalï¼šåˆå¹¶æ¥è‡ªäºä¸€ä¸ªæˆ–å¤šä¸ªç´¢å¼•çš„ç»“æœé›†ã€‚

  7ã€domain indexï¼šåº”ç”¨åŸŸç´¢å¼•ã€‚

  è¡¨è¿æ¥çš„æ‰§è¡Œè®¡åˆ’

   

  è¡¨è¿æ¥çš„å‡ ç§æ–¹å¼ï¼š

  1ã€SORT MERGE JOINï¼ˆæ’åº-åˆå¹¶è¿æ¥ï¼‰

  2ã€NESTED LOOPSï¼ˆåµŒå¥—å¾ªç¯ï¼‰

  3ã€HASH JOINï¼ˆå“ˆå¸Œè¿æ¥ï¼‰

  4ã€CARTESIAN PRODUCTï¼ˆç¬›å¡å°”ç§¯ï¼‰

4. 

### æ€»ç»“

å„è¿æ¥æ–¹æ³•è¯•ç”¨çš„åœºæ™¯ï¼š

- **æ’åº-åˆå¹¶è¿æ¥**
  1. å¯¹äºéç­‰å€¼è¿æ¥ï¼Œè¿™ç§æ–¹å¼æ•ˆç‡æ¯”è¾ƒé«˜
  2. å¦‚æœåœ¨å…³è”åˆ—ä¸Šæœ‰ç´¢å¼•ï¼Œæ•ˆæœæ›´å¥½
  3. å¯¹äºå°†ä¸¤ä¸ªæ¯”è¾ƒå¤§çš„row sourceåšè¿æ¥ï¼Œè¯¥è¿æ¥æ–¹æ³•æ¯”NLè¦å¥½
  4. å¦‚æœsort mergeè¿”å›çš„row sourceè¿‡å¤§ï¼Œåˆ™åˆä¼šä½¿ç”¨è¿‡å¤šçš„rowidåœ¨è¡¨ä¸­æŸ¥è¯¢æ•°æ®æ—¶ï¼Œæ•°æ®åº“æ€§èƒ½ä¸‹é™ï¼Œå› ä¸ºè¿‡å¤šçš„I/O
- **åµŒå¥—å¾ªç¯**
  1. å¦‚æœå¤–éƒ¨è¡¨æ¯”è¾ƒå°ï¼Œå¹¶ä¸”åœ¨å†…éƒ¨è¡¨ä¸Šæœ‰å”¯ä¸€ç´¢å¼•ï¼Œæˆ–è€…é«˜é€‰æ‹©æ€§ç´¢å¼•
  2. è¯¥æ–¹æ³•æœ‰å…¶å®ƒè¿æ¥æ–¹æ³•æ²¡æœ‰çš„ä¼˜ç‚¹ï¼šå¯ä»¥å…ˆè¿”å›å·²ç»è¿æ¥çš„è¡Œï¼Œè€Œä¸å¿…ç­‰å¾…æ‰€æœ‰çš„è¿æ¥æ“ä½œå¤„ç†å®Œæ‰è¿”å›æ•°æ®ï¼Œè¿™æ ·å¯ä»¥å®ç°å¿«é€Ÿçš„å“åº”æ—¶é—´
- **å“ˆå¸Œè¿æ¥**
  1. ä¸€èˆ¬æ¥è¯´ï¼Œå…¶æ•ˆç‡å¥½äºå…¶å®ƒä¸¤ç§è¿æ¥ï¼Œä½†è¿™ç§è¿æ¥åªèƒ½ç”¨åœ¨CBOä¼˜åŒ–ä¸­ï¼Œè€Œä¸”éœ€è¦è®¾ç½®åˆé€‚çš„ã€‚å‚æ•°
  2. åªç”¨äºç­‰å€¼è¿æ¥

#### 1.1å­—æ®µè§£é‡Š

| Operation              | å½“å‰æ“ä½œçš„å†…å®¹                                               |
| ---------------------- | ------------------------------------------------------------ |
| **Object**             | **æ“ä½œå¯¹è±¡**                                                 |
| **Optimizer**          | **ä¼˜åŒ–å™¨**                                                   |
| **Costï¼ˆCPU)**         | **Oracle è®¡ç®—å‡ºæ¥çš„ä¸€ä¸ªæ•°å€¼ï¼ˆä»£ä»·ï¼‰ï¼Œç”¨äºè¯´æ˜SQLæ‰§è¡Œçš„ä»£ä»·ã€‚** |
| **Cardinality**        | **åŸºæ•°**                                                     |
| **Bytes**              | **å­—èŠ‚**                                                     |
| **Access Predicates ** | **é€šè¿‡æŸç§æ–¹å¼å®šä½äº†éœ€è¦çš„æ•°æ®ï¼Œç„¶åè¯»å–å‡ºè¿™äº›ç»“æœé›†ï¼Œå«åšAccessã€‚<br/>è¡¨ç¤ºè¿™ä¸ªè°“è¯æ¡ä»¶çš„å€¼å°†ä¼šå½±å“æ•°æ®çš„è®¿é—®è·¯å¾„ï¼ˆè¡¨è¿˜æ˜¯ç´¢å¼•ï¼‰ã€‚** |
| **Filter Predicates**  | **æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½è®¿é—®äº†ï¼Œç„¶åè¿‡æ»¤æ‰ä¸éœ€è¦çš„æ•°æ®ï¼Œè¿™ç§æ–¹å¼å«åšfilter ã€‚<br/>è¡¨ç¤ºè°“è¯æ¡ä»¶çš„å€¼ä¸ä¼šå½±å“æ•°æ®çš„è®¿é—®è·¯å¾„ï¼Œåªèµ·è¿‡æ»¤çš„ä½œç”¨ã€‚** |

#### 2.1ğŸ”½ğŸ”½ğŸ”½æ‰§è¡Œé¡ºåºçš„åŸåˆ™

æ‰§è¡Œé¡ºåºçš„åŸåˆ™æ˜¯ï¼šç”±ä¸Šè‡³ä¸‹ï¼Œä»å³å‘å·¦
ç”±ä¸Šè‡³ä¸‹ï¼šåœ¨æ‰§è¡Œè®¡åˆ’ä¸­ä¸€èˆ¬å«æœ‰å¤šä¸ªèŠ‚ç‚¹ï¼Œç›¸åŒçº§åˆ«(æˆ–å¹¶åˆ—)çš„èŠ‚ç‚¹ï¼Œé ä¸Šçš„ä¼˜å…ˆæ‰§è¡Œï¼Œé ä¸‹çš„åæ‰§è¡Œ
ä»å³å‘å·¦ï¼šåœ¨æŸä¸ªèŠ‚ç‚¹ä¸‹è¿˜å­˜åœ¨å¤šä¸ªå­èŠ‚ç‚¹ï¼Œå…ˆä»æœ€é å³çš„å­èŠ‚ç‚¹å¼€å§‹æ‰§è¡Œã€‚

**ä¸€èˆ¬æŒ‰ç¼©è¿›é•¿åº¦æ¥åˆ¤æ–­ï¼Œç¼©è¿›æœ€å¤§çš„æœ€å…ˆæ‰§è¡Œï¼Œå¦‚æœæœ‰2è¡Œç¼©è¿›ä¸€æ ·ï¼Œé‚£ä¹ˆå°±å…ˆæ‰§è¡Œä¸Šé¢çš„ã€‚**



## SQLä¼˜åŒ–ç‚¹ï¼ˆä½çº§ï¼‰









## ä½¿ç”¨autotraceå·¥å…·ï¼ˆåªèƒ½SQLPLUSğŸ˜ï¼‰

```
 ç”¨æ³•1ï¼šæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ã€ç»Ÿè®¡ä¿¡æ¯å¹¶ä¸”è¿”å›sqlç»“æœé›†
set autotrace on;  

ç”¨æ³•2ï¼šæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ã€ç»Ÿè®¡ä¿¡æ¯ä¸è¿”å›sqlç»“æœé›†ï¼š

SQL> set autotrace traceonly;   

---æ–¹æ³•3ï¼šåªçœ‹æ‰§è¡Œè®¡åˆ’ä¸è¿”å›sqlç»“æœé›†ï¼š

QL> set autotrace traceonly explain;  
```



#### æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ã€ç»Ÿè®¡ä¿¡æ¯ã€æ‰§è¡Œæ—¶é—´å¹¶ä¸”è¿”å›sqlç»“æœé›†ï¼š

```plsql
SQL> set autotrace on;
SQL> set timing on;
SQL> select count(*) from t;

  COUNT(*)
----------
     50295

å·²ç”¨æ—¶é—´:  00: 00: 00.01

æ‰§è¡Œè®¡åˆ’
----------------------------------------------------------
Plan hash value: 2966233522

-------------------------------------------------------------------
| Id  | Operation          | Name | Rows  | Cost (%CPU)| Time     |
-------------------------------------------------------------------
|   0 | SELECT STATEMENT   |      |     1 |   159   (2)| 00:00:02 |
|   1 |  SORT AGGREGATE    |      |     1 |            |          |
|   2 |   TABLE ACCESS FULL| T    | 50295 |   159   (2)| 00:00:02 |
-------------------------------------------------------------------


ç»Ÿè®¡ä¿¡æ¯
----------------------------------------------------------
          0  recursive calls
          0  db block gets
          0  consistent gets
          0  physical reads
          0  redo size
        509  bytes sent via SQL*Net to client
        211  bytes received via SQL*Net from client
          2  SQL*Net roundtrips to/from client
          1  sorts (memory)
          0  sorts (disk)
          1  rows processed
```

#### æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ã€ç»Ÿè®¡ä¿¡æ¯ã€æ‰§è¡Œæ—¶é—´ä¸è¿”å›sqlç»“æœé›†ï¼š

```plsql
SQL> set timing on;
SQL> set autotrace traceonly;
SQL> select * from t2;

å·²é€‰æ‹©402344è¡Œã€‚

å·²ç”¨æ—¶é—´:  00: 00: 20.66

æ‰§è¡Œè®¡åˆ’
----------------------------------------------------------
Plan hash value: 1513984157

--------------------------------------------------------------------------
| Id  | Operation         | Name | Rows  | Bytes | Cost (%CPU)| Time     |
--------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |      |   402K|    33M|  1240   (3)| 00:00:15 |
|   1 |  TABLE ACCESS FULL| T2   |   402K|    33M|  1240   (3)| 00:00:15 |
--------------------------------------------------------------------------


ç»Ÿè®¡ä¿¡æ¯
----------------------------------------------------------
          0  recursive calls
          0  db block gets
          0  consistent gets
          0  physical reads
          0  redo size
        911  bytes sent via SQL*Net to client
        190  bytes received via SQL*Net from client
          2  SQL*Net roundtrips to/from client
          1  sorts (memory)
          0  sorts (disk)
     402344  rows processed
```

#### åªçœ‹æ‰§è¡Œè®¡åˆ’ã€æ‰§è¡Œæ—¶é—´ä¸è¿”å›sqlç»“æœé›†ï¼š

```plsql
SQL> set timing on;
SQL> set autotrace traceonly explain;
SQL> select * from t;
å·²ç”¨æ—¶é—´:  00: 00: 00.01

æ‰§è¡Œè®¡åˆ’
----------------------------------------------------------
Plan hash value: 1601196873

--------------------------------------------------------------------------
| Id  | Operation         | Name | Rows  | Bytes | Cost (%CPU)| Time     |
--------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |      | 50295 |  4273K|   161   (3)| 00:00:02 |
|   1 |  TABLE ACCESS FULL| T    | 50295 |  4273K|   161   (3)| 00:00:02 |
--------------------------------------------------------------------------
```

#### åªçœ‹ç»Ÿè®¡ä¿¡æ¯ã€æ‰§è¡Œæ—¶é—´ä¸è¿”å›sqlç»“æœé›†ï¼š

```plsql
SQL> set timing on;
SQL> set autotrace traceonly statistics;
SQL> select * from t;

å·²é€‰æ‹©50295è¡Œã€‚

å·²ç”¨æ—¶é—´:  00: 00: 02.59

ç»Ÿè®¡ä¿¡æ¯
----------------------------------------------------------
          0  recursive calls
          0  db block gets
          0  consistent gets
          0  physical reads
          0  redo size
        911  bytes sent via SQL*Net to client
        189  bytes received via SQL*Net from client
          2  SQL*Net roundtrips to/from client
          1  sorts (memory)
          0  sorts (disk)
      50295  rows processed
```

#### æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ï¼š

```plsql
SQL> set autotrace
ç”¨æ³•: SET AUTOT[RACE] {OFF | ON | TRACE[ONLY]} [EXP[LAIN]] [STAT[ISTICS]]
```

#### å¦‚ä½•å¼€çœ‹ç»Ÿè®¡ä¿¡æ¯ï¼š

```plsql
SQL> show parameter db_block_size

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
db_block_size                        integer     8192
SQL> set linesize 200
SQL> alter system flush shared_pool;      --æ¸…ç©ºshared_pool

ç³»ç»Ÿå·²æ›´æ”¹ã€‚

SQL> alter system flush buffer_cache;    --æ¸…ç©ºbuffer_cache

ç³»ç»Ÿå·²æ›´æ”¹ã€‚

SQL> set timing on;
SQL> set autotrace traceonly;
SQL> select * from t2 order by object_name;

å·²é€‰æ‹©402344è¡Œã€‚

å·²ç”¨æ—¶é—´:  00: 00: 23.79      --æ‰§è¡Œäº†23.79ç§’

æ‰§è¡Œè®¡åˆ’
----------------------------------------------------------
Plan hash value: 2552596561

-----------------------------------------------------------------------------------
| Id  | Operation          | Name | Rows  | Bytes |TempSpc| Cost (%CPU)| Time     |
-----------------------------------------------------------------------------------
|   0 | SELECT STATEMENT   |      |   402K|    33M|       |  9361   (2)| 00:01:53 |
|   1 |  SORT ORDER BY     |      |   402K|    33M|    92M|  9361   (2)| 00:01:53 |
|   2 |   TABLE ACCESS FULL| T2   |   402K|    33M|       |  1240   (3)| 00:00:15 |
-----------------------------------------------------------------------------------


ç»Ÿè®¡ä¿¡æ¯
----------------------------------------------------------
        525  recursive calls
         30  db block gets
       5606  consistent gets
      11129  physical reads
          0  redo size
   13462598  bytes sent via SQL*Net to client
     295442  bytes received via SQL*Net from client
      26824  SQL*Net roundtrips to/from client
          4  sorts (memory)
          1  sorts (disk)
     402344  rows processed
```

æ‰§è¡Œäº†23.79ç§’ã€‚

æ¶ˆè€—çš„å†…å­˜ï¼š5606*8192/1024/1024=43.7M

I/Oæ¶ˆè€—ï¼š11129*8192/1024/1024=86.9M

# Mysqlçš„Sqlä¼˜åŒ–ç¬”è®°

## æ“ä½œç¬¦ä¼˜åŒ–

**1ã€IN æ“ä½œç¬¦**

ç”¨INå†™å‡ºæ¥çš„SQLçš„ä¼˜ç‚¹æ˜¯æ¯”è¾ƒå®¹æ˜“å†™åŠæ¸…æ™°æ˜“æ‡‚ï¼Œè¿™æ¯”è¾ƒé€‚åˆç°ä»£è½¯ä»¶å¼€å‘çš„é£æ ¼ã€‚ä½†æ˜¯ç”¨INçš„SQLæ€§èƒ½æ€»æ˜¯æ¯”è¾ƒä½çš„ï¼Œä»Oracleæ‰§è¡Œçš„æ­¥éª¤æ¥åˆ†æç”¨INçš„SQLä¸ä¸ç”¨INçš„SQLæœ‰ä»¥ä¸‹åŒºåˆ«ï¼š

ORACLEè¯•å›¾å°†å…¶è½¬æ¢æˆå¤šä¸ªè¡¨çš„è¿æ¥ï¼Œå¦‚æœè½¬æ¢ä¸æˆåŠŸåˆ™å…ˆæ‰§è¡ŒINé‡Œé¢çš„å­æŸ¥è¯¢ï¼Œå†æŸ¥è¯¢å¤–å±‚çš„è¡¨è®°å½•ï¼Œå¦‚æœè½¬æ¢æˆåŠŸåˆ™ç›´æ¥é‡‡ç”¨å¤šä¸ªè¡¨çš„è¿æ¥æ–¹å¼æŸ¥è¯¢ã€‚ç”±æ­¤å¯è§ç”¨INçš„SQLè‡³å°‘å¤šäº†ä¸€ä¸ªè½¬æ¢çš„è¿‡ç¨‹ã€‚ä¸€èˆ¬çš„SQLéƒ½å¯ä»¥è½¬æ¢æˆåŠŸï¼Œä½†å¯¹äºå«æœ‰åˆ†ç»„ç»Ÿè®¡ç­‰æ–¹é¢çš„SQLå°±ä¸èƒ½è½¬æ¢äº†ã€‚

**æ¨èæ–¹æ¡ˆï¼š**åœ¨ä¸šåŠ¡å¯†é›†çš„SQLå½“ä¸­å°½é‡ä¸é‡‡ç”¨INæ“ä½œç¬¦ï¼Œç”¨EXISTS æ–¹æ¡ˆä»£æ›¿ã€‚

**2ã€NOT INæ“ä½œç¬¦**

æ­¤æ“ä½œæ˜¯å¼ºåˆ—ä¸æ¨èä½¿ç”¨çš„ï¼Œå› ä¸ºå®ƒä¸èƒ½åº”ç”¨è¡¨çš„ç´¢å¼•ã€‚

**æ¨èæ–¹æ¡ˆï¼š**ç”¨NOT EXISTS æ–¹æ¡ˆä»£æ›¿

**3ã€IS NULL æˆ–IS NOT NULLæ“ä½œ**ï¼ˆåˆ¤æ–­å­—æ®µæ˜¯å¦ä¸ºç©ºï¼‰

åˆ¤æ–­å­—æ®µæ˜¯å¦ä¸ºç©ºä¸€èˆ¬æ˜¯ä¸ä¼šåº”ç”¨ç´¢å¼•çš„ï¼Œå› ä¸ºç´¢å¼•æ˜¯ä¸ç´¢å¼•ç©ºå€¼çš„ã€‚

**æ¨èæ–¹æ¡ˆ**ï¼šç”¨å…¶å®ƒç›¸åŒåŠŸèƒ½çš„æ“ä½œè¿ç®—ä»£æ›¿ï¼Œå¦‚ï¼ša is not null æ”¹ä¸º a>0 æˆ–a>â€™â€™ç­‰ã€‚ä¸å…è®¸å­—æ®µä¸ºç©ºï¼Œè€Œç”¨ä¸€ä¸ªç¼ºçœå€¼ä»£æ›¿ç©ºå€¼ï¼Œå¦‚ç”³è¯·ä¸­çŠ¶æ€å­—æ®µä¸å…è®¸ä¸ºç©ºï¼Œç¼ºçœä¸ºç”³è¯·ã€‚

**4ã€> åŠ < æ“ä½œç¬¦ï¼ˆå¤§äºæˆ–å°äºæ“ä½œç¬¦ï¼‰**

å¤§äºæˆ–å°äºæ“ä½œç¬¦ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸ç”¨è°ƒæ•´çš„ï¼Œå› ä¸ºå®ƒæœ‰ç´¢å¼•å°±ä¼šé‡‡ç”¨ç´¢å¼•æŸ¥æ‰¾ï¼Œä½†æœ‰çš„æƒ…å†µä¸‹å¯ä»¥å¯¹å®ƒè¿›è¡Œä¼˜åŒ–ï¼Œå¦‚ä¸€ä¸ªè¡¨æœ‰100ä¸‡è®°å½•ï¼Œä¸€ä¸ªæ•°å€¼å‹å­—æ®µAï¼Œ30ä¸‡è®°å½•çš„A=0ï¼Œ30ä¸‡è®°å½•çš„A=1ï¼Œ39ä¸‡è®°å½•çš„A=2ï¼Œ1ä¸‡è®°å½•çš„A=3ã€‚é‚£ä¹ˆæ‰§è¡ŒA>2ä¸A>=3çš„æ•ˆæœå°±æœ‰å¾ˆå¤§çš„åŒºåˆ«äº†ï¼Œå› ä¸ºA>2æ—¶ORACLEä¼šå…ˆæ‰¾å‡ºä¸º2çš„è®°å½•ç´¢å¼•å†è¿›è¡Œæ¯”è¾ƒï¼Œè€ŒA>=3æ—¶ORACLEåˆ™ç›´æ¥æ‰¾åˆ°=3çš„è®°å½•ç´¢å¼•ã€‚

**5ã€LIKEæ“ä½œç¬¦**

LIKEæ“ä½œç¬¦å¯ä»¥åº”ç”¨é€šé…ç¬¦æŸ¥è¯¢ï¼Œé‡Œé¢çš„é€šé…ç¬¦ç»„åˆå¯èƒ½è¾¾åˆ°å‡ ä¹æ˜¯ä»»æ„çš„æŸ¥è¯¢ï¼Œä½†æ˜¯å¦‚æœç”¨å¾—ä¸å¥½åˆ™ä¼šäº§ç”Ÿæ€§èƒ½ä¸Šçš„é—®é¢˜ï¼Œå¦‚LIKE â€˜%5400%â€™ è¿™ç§æŸ¥è¯¢ä¸ä¼šå¼•ç”¨ç´¢å¼•ï¼Œè€ŒLIKE â€˜X5400%â€™åˆ™ä¼šå¼•ç”¨èŒƒå›´ç´¢å¼•ã€‚

ä¸€ä¸ªå®é™…ä¾‹å­ï¼šç”¨YW_YHJBQKè¡¨ä¸­è¥ä¸šç¼–å·åé¢çš„æˆ·æ ‡è¯†å·å¯æ¥æŸ¥è¯¢è¥ä¸šç¼–å· YY_BH LIKE â€˜%5400%â€™ è¿™ä¸ªæ¡ä»¶ä¼šäº§ç”Ÿå…¨è¡¨æ‰«æï¼Œå¦‚æœæ”¹æˆYY_BH LIKE â€™X5400%â€™ OR YY_BH LIKE â€™B5400%â€™ åˆ™ä¼šåˆ©ç”¨YY_BHçš„ç´¢å¼•è¿›è¡Œä¸¤ä¸ªèŒƒå›´çš„æŸ¥è¯¢ï¼Œæ€§èƒ½è‚¯å®šå¤§å¤§æé«˜ã€‚

**6ã€UNIONæ“ä½œç¬¦**

UNIONåœ¨è¿›è¡Œè¡¨é“¾æ¥åä¼šç­›é€‰æ‰é‡å¤çš„è®°å½•ï¼Œæ‰€ä»¥åœ¨è¡¨é“¾æ¥åä¼šå¯¹æ‰€äº§ç”Ÿçš„ç»“æœé›†è¿›è¡Œæ’åºè¿ç®—ï¼Œåˆ é™¤é‡å¤çš„è®°å½•å†è¿”å›ç»“æœã€‚å®é™…å¤§éƒ¨åˆ†åº”ç”¨ä¸­æ˜¯ä¸ä¼šäº§ç”Ÿé‡å¤çš„è®°å½•ï¼Œæœ€å¸¸è§çš„æ˜¯è¿‡ç¨‹è¡¨ä¸å†å²è¡¨UNIONã€‚å¦‚ï¼š
select * from gc_dfys
union
select * from ls_jg_dfys
è¿™ä¸ªSQLåœ¨è¿è¡Œæ—¶å…ˆå–å‡ºä¸¤ä¸ªè¡¨çš„ç»“æœï¼Œå†ç”¨æ’åºç©ºé—´è¿›è¡Œæ’åºåˆ é™¤é‡å¤çš„è®°å½•ï¼Œæœ€åè¿”å›ç»“æœé›†ï¼Œå¦‚æœè¡¨æ•°æ®é‡å¤§çš„è¯å¯èƒ½ä¼šå¯¼è‡´ç”¨ç£ç›˜è¿›è¡Œæ’åºã€‚

**æ¨èæ–¹æ¡ˆï¼š**é‡‡ç”¨UNION ALLæ“ä½œç¬¦æ›¿ä»£UNIONï¼Œå› ä¸ºUNION ALLæ“ä½œåªæ˜¯ç®€å•çš„å°†ä¸¤ä¸ªç»“æœåˆå¹¶åå°±è¿”å›ã€‚

select * from gc_dfys
union all
select * from ls_jg_dfys

### **SQLä¹¦å†™çš„å½±å“**

**1ã€åŒä¸€åŠŸèƒ½åŒä¸€æ€§èƒ½ä¸åŒå†™æ³•SQLçš„å½±å“ã€‚**

å¦‚ä¸€ä¸ªSQLåœ¨Aç¨‹åºå‘˜å†™çš„ä¸º  Select * from zl_yhjbqk

Bç¨‹åºå‘˜å†™çš„ä¸º Select * from dlyx.zl_yhjbqkï¼ˆå¸¦è¡¨æ‰€æœ‰è€…çš„å‰ç¼€ï¼‰

Cç¨‹åºå‘˜å†™çš„ä¸º Select * from DLYX.ZLYHJBQKï¼ˆå¤§å†™è¡¨åï¼‰

Dç¨‹åºå‘˜å†™çš„ä¸º Select *  from DLYX.ZLYHJBQKï¼ˆä¸­é—´å¤šäº†ç©ºæ ¼ï¼‰

ä»¥ä¸Šå››ä¸ªSQLåœ¨ORACLEåˆ†ææ•´ç†ä¹‹åäº§ç”Ÿçš„ç»“æœåŠæ‰§è¡Œçš„æ—¶é—´æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä»ORACLEå…±äº«å†…å­˜SGAçš„åŸç†ï¼Œå¯ä»¥å¾—å‡ºORACLEå¯¹æ¯ä¸ªSQL éƒ½ä¼šå¯¹å…¶è¿›è¡Œä¸€æ¬¡åˆ†æï¼Œå¹¶ä¸”å ç”¨å…±äº«å†…å­˜ï¼Œå¦‚æœå°†SQLçš„å­—ç¬¦ä¸²åŠæ ¼å¼å†™å¾—å®Œå…¨ç›¸åŒï¼Œåˆ™ORACLEåªä¼šåˆ†æä¸€æ¬¡ï¼Œå…±äº«å†…å­˜ä¹Ÿåªä¼šç•™ä¸‹ä¸€æ¬¡çš„åˆ†æç»“æœï¼Œè¿™ä¸ä»…å¯ä»¥å‡å°‘åˆ†æSQLçš„æ—¶é—´ï¼Œè€Œä¸”å¯ä»¥å‡å°‘å…±äº«å†…å­˜é‡å¤çš„ä¿¡æ¯ï¼ŒORACLEä¹Ÿå¯ä»¥å‡†ç¡®ç»Ÿè®¡SQLçš„æ‰§è¡Œé¢‘ç‡ã€‚

**2ã€WHEREåé¢çš„æ¡ä»¶é¡ºåºå½±å“**

WHEREå­å¥åé¢çš„æ¡ä»¶é¡ºåºå¯¹å¤§æ•°æ®é‡è¡¨çš„æŸ¥è¯¢ä¼šäº§ç”Ÿç›´æ¥çš„å½±å“ã€‚å¦‚ï¼š
Select * from zl_yhjbqk where dy_dj = '1KVä»¥ä¸‹' and xh_bz=1
Select * from zl_yhjbqk where xh_bz=1 and dy_dj = '1KVä»¥ä¸‹'
ä»¥ä¸Šä¸¤ä¸ªSQLä¸­dy_djï¼ˆç”µå‹ç­‰çº§ï¼‰åŠxh_bzï¼ˆé”€æˆ·æ ‡å¿—ï¼‰ä¸¤ä¸ªå­—æ®µéƒ½æ²¡è¿›è¡Œç´¢å¼•ï¼Œæ‰€ä»¥æ‰§è¡Œçš„æ—¶å€™éƒ½æ˜¯å…¨è¡¨æ‰«æï¼Œç¬¬ä¸€æ¡SQLçš„dy_dj = '1KVä»¥ä¸‹'æ¡ä»¶åœ¨è®°å½•é›†å†…æ¯”ç‡ä¸º99%ï¼Œè€Œxh_bz=1çš„æ¯”ç‡åªä¸º0.5%ï¼Œåœ¨è¿›è¡Œç¬¬ä¸€æ¡SQLçš„æ—¶å€™99%æ¡è®°å½•éƒ½è¿›è¡Œdy_djåŠxh_bzçš„æ¯”è¾ƒï¼Œè€Œåœ¨è¿›è¡Œç¬¬äºŒæ¡SQLçš„æ—¶å€™0.5%æ¡è®°å½•éƒ½è¿›è¡Œdy_djåŠxh_bzçš„æ¯”è¾ƒï¼Œä»¥æ­¤å¯ä»¥å¾—å‡ºç¬¬äºŒæ¡SQLçš„CPUå ç”¨ç‡æ˜æ˜¾æ¯”ç¬¬ä¸€æ¡ä½ã€‚

**3ã€æŸ¥è¯¢è¡¨é¡ºåºçš„å½±å“**

åœ¨FROMåé¢çš„è¡¨ä¸­çš„åˆ—è¡¨é¡ºåºä¼šå¯¹SQLæ‰§è¡Œæ€§èƒ½å½±å“ï¼Œåœ¨æ²¡æœ‰ç´¢å¼•åŠORACLEæ²¡æœ‰å¯¹è¡¨è¿›è¡Œç»Ÿè®¡åˆ†æçš„æƒ…å†µä¸‹ï¼ŒORACLEä¼šæŒ‰è¡¨å‡ºç°çš„é¡ºåºè¿›è¡Œé“¾æ¥ï¼Œç”±æ­¤å¯è§è¡¨çš„é¡ºåºä¸å¯¹æ—¶ä¼šäº§ç”Ÿååˆ†è€—æœç‰©å™¨èµ„æºçš„æ•°æ®äº¤å‰ã€‚ï¼ˆæ³¨ï¼šå¦‚æœå¯¹è¡¨è¿›è¡Œäº†ç»Ÿè®¡åˆ†æï¼ŒORACLEä¼šè‡ªåŠ¨å…ˆè¿›å°è¡¨çš„é“¾æ¥ï¼Œå†è¿›è¡Œå¤§è¡¨çš„é“¾æ¥ï¼‰

### **SQLè¯­å¥ç´¢å¼•çš„åˆ©ç”¨**

**1ã€æ“ä½œç¬¦ä¼˜åŒ–ï¼ˆåŒä¸Šï¼‰**

**2ã€å¯¹æ¡ä»¶å­—æ®µçš„ä¸€äº›ä¼˜åŒ–**

**é‡‡ç”¨å‡½æ•°å¤„ç†çš„å­—æ®µä¸èƒ½åˆ©ç”¨ç´¢å¼•ï¼Œ**å¦‚ï¼š

substr(hbs_bh,1,4)=â€™5400â€™ï¼Œä¼˜åŒ–å¤„ç†ï¼šhbs_bh like â€˜5400%â€™

trunc(sk_rq)=trunc(sysdate)ï¼Œ ä¼˜åŒ–å¤„ç†ï¼šsk_rq>=trunc(sysdate) and sk_rq<trunc(sysdate+1)

è¿›è¡Œäº†æ˜¾å¼æˆ–éšå¼çš„è¿ç®—çš„å­—æ®µä¸èƒ½è¿›è¡Œç´¢å¼•ï¼Œå¦‚ï¼šss_df+20>50ï¼Œä¼˜åŒ–å¤„ç†ï¼šss_df>30

â€˜Xâ€™ || hbs_bh>â€™X5400021452â€™ï¼Œä¼˜åŒ–å¤„ç†ï¼šhbs_bh>â€™5400021542â€™

sk_rq+5=sysdateï¼Œä¼˜åŒ–å¤„ç†ï¼šsk_rq=sysdate-5

hbs_bh=5401002554ï¼Œä¼˜åŒ–å¤„ç†ï¼šhbs_bh=â€™ 5401002554â€™ï¼Œæ³¨ï¼šæ­¤æ¡ä»¶å¯¹hbs_bh è¿›è¡Œéšå¼çš„to_numberè½¬æ¢ï¼Œå› ä¸ºhbs_bhå­—æ®µæ˜¯å­—ç¬¦å‹ã€‚

**æ¡ä»¶å†…åŒ…æ‹¬äº†å¤šä¸ªæœ¬è¡¨çš„å­—æ®µè¿ç®—æ—¶ä¸èƒ½è¿›è¡Œç´¢å¼•**ï¼Œå¦‚ï¼šys_df>cx_dfï¼Œæ— æ³•è¿›è¡Œä¼˜åŒ–
qc_bh || kh_bh=â€™5400250000â€™ï¼Œä¼˜åŒ–å¤„ç†ï¼šqc_bh=â€™5400â€™ and kh_bh=â€™250000â€™

<h2 style='color:#D886C7'>SQLä¼˜åŒ–çš„ä¸€äº›æ–¹æ³•</h1>


##### orcale

- [Oracle SQLæ€§èƒ½ä¼˜åŒ–40æ¡](https://mp.weixin.qq.com/s/GCS2m03zAfXoQdFBhy0JXw)
- [å…³äºOracleçš„sqlä¼˜åŒ–](https://mp.weixin.qq.com/s/YI40HEZck49nnHXouSKZOw)

#####  mysql

